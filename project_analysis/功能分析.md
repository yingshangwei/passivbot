# Passivbot 功能分析报告

## 项目概述

Passivbot 是一个用 Python 和 Rust 编写的加密货币交易机器人，专门用于永续期货衍生品市场。该机器人设计为需要最少的用户干预即可运行，采用反向做市策略，不预测价格走势，而是作为价格稳定器为市场提供流动性。

## 核心交易策略

### 1. 反向做市策略 (Contrarian Market Making)
- **核心理念**：不预测未来价格走势，不使用技术指标，不跟随趋势
- **市场角色**：作为价格稳定器，为价格双向变动提供阻力
- **服务目标**：通过"服务市场"来稳定价格

### 2. 网格交易系统 (Grid Trading)
- **策略基础**：受 Martingale 投注策略启发
- **入场机制**：
  - 小额初始入场
  - 在亏损时多次加倍下注
  - 将平均入场价格拉近当前价格走势
- **订单布局**：将订单放置在网格中，准备吸收突然的价格变动
- **止盈机制**：每次重新入场后快速更新止盈订单，设定固定的止盈标记

### 3. 追踪订单系统 (Trailing Orders)

#### 追踪入场 (Trailing Entries)
- 等待价格超过指定阈值
- 然后回调定义百分比后下重新入场订单
- 提高入场时机的精确性

#### 追踪平仓 (Trailing Closes)
- 等待价格有利变动达到阈值百分比
- 然后回调指定百分比后下平仓订单
- 通过在市场显示反转迹象时退出仓位来更有效地锁定利润

#### 组合使用
- 网格订单和追踪订单可以结合使用
- 机器人可以部分或全部使用网格订单和/或追踪订单来入场或平仓

### 4. Forager 功能
- **动态市场选择**：自动选择最波动的市场开仓
- **波动率定义**：最近1分钟K线的标准化相对范围均值
- **计算公式**：`mean((ohlcv.high - ohlcv.low) / ohlcv.close)`
- **优势**：自动识别高波动性交易机会

### 5. 解套机制 (Unstucking Mechanism)
- **目标**：管理表现不佳或"卡住"的仓位
- **策略**：通过实现小额亏损来解套
- **优先级**：优先处理入场价与当前市价差距最小的仓位
- **风险控制**：确保账户余额不会低于过去峰值余额的设定百分比

## 支持的交易所

### 主要交易所
1. **Binance** (币安) - 全球最大的加密货币交易所
2. **Bybit** - 专业的衍生品交易平台
3. **OKX** - 全球领先的数字资产交易平台
4. **Bitget** - 专业的加密货币衍生品交易平台
5. **GateIO** - 全球数字资产交易平台
6. **Kucoin** - 全球加密货币交易所
7. **Hyperliquid** - 去中心化永续合约交易平台

### 交易所集成特点
- 统一的API接口
- 支持多种订单类型
- 实时市场数据获取
- 账户余额和仓位管理

## 核心功能模块

### 1. 回测系统 (Backtesting)
- **历史数据回测**：使用历史价格数据测试策略
- **性能优化**：CPU密集型函数用Rust编写
- **分析工具**：包含完整的回测分析工具
- **数据管理**：支持数据缓存和压缩

### 2. 优化器 (Optimizer)
- **进化算法**：通过迭代数千次回测寻找最优配置
- **参数优化**：自动调整策略参数
- **收敛机制**：使用进化算法收敛到最优解
- **多目标优化**：平衡收益和风险

### 3. 配置管理系统
- **灵活配置**：JSON格式的配置文件
- **多币种支持**：支持同时交易多种加密货币
- **预优化模板**：提供经过优化的配置模板
- **动态调整**：支持运行时配置调整

### 4. 数据管理系统
- **自动下载**：自动下载和管理市场数据
- **数据缓存**：K线数据缓存和压缩
- **多数据源**：支持多种数据源
- **实时更新**：实时市场数据更新

### 5. 可视化工具
- **交互式图表**：提供交互式图表功能
- **回测可视化**：回测结果的可视化展示
- **实时监控**：实时交易状态监控
- **性能分析**：交易性能分析图表

## 风险管理功能

### 1. 仓位管理
- **仓位大小控制**：动态调整仓位大小
- **总钱包风险限制**：设置总钱包风险上限
- **多仓位管理**：同时管理多个交易对

### 2. 止损止盈
- **动态止损**：基于市场条件的动态止损
- **固定止盈**：设定固定的止盈目标
- **追踪止盈**：使用追踪止盈锁定利润

### 3. 风险监控
- **实时监控**：实时监控交易风险
- **预警系统**：风险超限时的预警机制
- **自动调整**：根据风险状况自动调整策略

## 部署和运行

### 1. 环境要求
- **Python版本**：>= 3.8
- **Rust环境**：用于高性能计算组件
- **依赖管理**：通过requirements.txt管理Python依赖

### 2. 部署选项
- **本地运行**：直接在本地环境运行
- **Docker容器**：使用Docker容器化部署
- **跨平台支持**：支持Windows、Linux、macOS

### 3. 配置和启动
- **API密钥配置**：安全的交易所API集成
- **配置文件**：使用JSON配置文件
- **启动命令**：简单的命令行启动

## 工具和实用程序

### 1. Jupyter Lab 支持
- **数据分析**：用于数据分析和策略开发
- **交互式开发**：支持交互式策略开发
- **可视化分析**：数据可视化分析工具

### 2. 日志系统
- **完整日志**：记录所有交易活动
- **错误追踪**：详细的错误日志
- **性能监控**：性能指标记录

### 3. 测试工具
- **单元测试**：完整的单元测试套件
- **集成测试**：系统集成测试
- **回测验证**：策略回测验证

## 总结

Passivbot 是一个功能完整的量化交易系统，具有以下特点：

1. **策略先进**：采用反向做市和网格交易策略
2. **技术先进**：Python + Rust 混合架构，性能优异
3. **功能完整**：从回测到实盘交易的完整解决方案
4. **风险可控**：完善的风险管理和监控机制
5. **易于使用**：简单的配置和部署流程
6. **扩展性强**：支持多交易所、多币种交易

该系统特别适合加密货币永续期货市场的自动化交易，为交易者提供了一个强大、灵活且可靠的交易工具。
