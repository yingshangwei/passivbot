<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Passivbot å¢å¼ºç‰ˆé…ç½®å¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            background: white;
            color: #2c3e50;
            border-bottom: 3px solid #007bff;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            background: #f8f9fa;
        }

        .form-section h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #495057;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .status-panel {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-label {
            font-weight: 500;
            color: #495057;
        }

        .status-value {
            color: #6c757d;
        }

        .status-value.success {
            color: #28a745;
        }

        .status-value.error {
            color: #dc3545;
        }

        .status-value.warning {
            color: #ffc107;
        }

        .results-panel {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .results-section {
            margin-bottom: 20px;
        }

        .results-section h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #6c757d;
            font-size: 0.9em;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid transparent;
            border-radius: 5px;
        }

        .alert-success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }

        .alert-danger {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }

        .alert-warning {
            color: #856404;
            background-color: #fff3cd;
            border-color: #ffeaa7;
        }

        .alert-info {
            color: #0c5460;
            background-color: #d1ecf1;
            border-color: #bee5eb;
        }

        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        .config-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .config-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
        }

        .config-section h6 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1em;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 5px;
        }

        .config-params {
            display: grid;
            gap: 8px;
        }

        .config-param {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid #f1f3f4;
        }

        .config-param:last-child {
            border-bottom: none;
        }

        .param-name {
            font-weight: 500;
            color: #495057;
            font-size: 0.9em;
        }

        .param-value {
            color: #6c757d;
            font-size: 0.9em;
            text-align: right;
            max-width: 60%;
            word-break: break-all;
        }

        .results-section {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
        }

        .results-section h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .results-section h5 {
            color: #495057;
            margin: 15px 0 10px 0;
            font-size: 1.1em;
        }

        .config-edit-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .config-edit-section h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 2px solid #007bff;
            padding-bottom: 8px;
        }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .metric-grid {
                grid-template-columns: 1fr;
            }
            
            .config-details-grid {
                grid-template-columns: 1fr;
            }
            
            .config-param {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .param-value {
                max-width: 100%;
                text-align: left;
                margin-top: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– Passivbot å¢å¼ºç‰ˆé…ç½®å¹³å°</h1>
            <p>é…ç½®ç”Ÿæˆ | åœ¨çº¿å›æµ‹ | ç»“æœåˆ†æ</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('config')">âš™ï¸ é…ç½®ç®¡ç†</button>
            <button class="nav-tab" onclick="switchTab('backtest')">ğŸ“Š å›æµ‹æ‰§è¡Œ</button>
            <button class="nav-tab" onclick="switchTab('results')">ğŸ“ˆ ç»“æœåˆ†æ</button>
            <button class="nav-tab" onclick="switchTab('config-manage')">ğŸ”§ é…ç½®å·¥å…·</button>
        </div>

        <!-- é…ç½®ç®¡ç†æ ‡ç­¾é¡µ -->
        <div id="config" class="tab-content active">
            <div class="form-section">
                <h3>ğŸ“‹ åŸºç¡€é…ç½®</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>å›æµ‹å¼€å§‹æ—¥æœŸ</label>
                        <input type="date" id="start_date" value="2024-01-01">
                    </div>
                    <div class="form-group">
                        <label>å›æµ‹ç»“æŸæ—¥æœŸ</label>
                        <input type="date" id="end_date" value="2024-01-31">
                    </div>
                    <div class="form-group">
                        <label>åˆå§‹èµ„é‡‘</label>
                        <input type="number" id="starting_balance" value="10000" min="1000" step="1000">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>äº¤æ˜“æ‰€</label>
                        <select id="exchange">
                            <option value="binance">Binance</option>
                            <option value="okx">OKX</option>
                            <option value="bybit">Bybit</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>äº¤æ˜“å¯¹</label>
                        <select id="symbol">
                            <option value="BTCUSDT">BTC/USDT</option>
                            <option value="ETHUSDT">ETH/USDT</option>
                            <option value="ADAUSDT">ADA/USDT</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>ğŸ“ˆ å¤šå¤´ç­–ç•¥å‚æ•°</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>å…¥åœºç½‘æ ¼é—´è· (%)</label>
                        <input type="number" id="entry_grid_spacing_pct" value="0.01" min="0.001" max="0.1" step="0.001">
                    </div>
                    <div class="form-group">
                        <label>åˆå§‹å…¥åœºæ•°é‡ (%)</label>
                        <input type="number" id="entry_initial_qty_pct" value="0.01" min="0.001" max="0.1" step="0.001">
                    </div>
                    <div class="form-group">
                        <label>æœ€å¤§æŒä»“æ•°</label>
                        <input type="number" id="n_positions" value="3" min="1" max="10" step="1">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>å¹³ä»“ç½‘æ ¼èµ·å§‹ (%)</label>
                        <input type="number" id="close_grid_markup_start" value="0.002" min="0.001" max="0.05" step="0.001">
                    </div>
                    <div class="form-group">
                        <label>å¹³ä»“ç½‘æ ¼ç»“æŸ (%)</label>
                        <input type="number" id="close_grid_markup_end" value="0.001" min="0.001" max="0.05" step="0.001">
                    </div>
                    <div class="form-group">
                        <label>æ€»èµ„é‡‘æš´éœ²é™åˆ¶</label>
                        <input type="number" id="total_wallet_exposure_limit" value="0.5" min="0.1" max="2.0" step="0.1">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>ğŸ“‰ ç©ºå¤´ç­–ç•¥å‚æ•°</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label>å…¥åœºç½‘æ ¼é—´è· (%)</label>
                        <input type="number" id="short_entry_grid_spacing_pct" value="0.01" min="0.001" max="0.1" step="0.001">
                    </div>
                    <div class="form-group">
                        <label>åˆå§‹å…¥åœºæ•°é‡ (%)</label>
                        <input type="number" id="short_entry_initial_qty_pct" value="0.01" min="0.001" max="0.1" step="0.001">
                    </div>
                    <div class="form-group">
                        <label>æœ€å¤§æŒä»“æ•°</label>
                        <input type="number" id="short_n_positions" value="3" min="1" max="10" step="1">
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>ğŸ¯ é¢„è®¾é…ç½®</h3>
                <div style="margin-bottom: 15px;">
                    <button class="btn btn-primary" onclick="loadPreset('conservative')">ä¿å®ˆå‹</button>
                    <button class="btn btn-primary" onclick="loadPreset('moderate')">ç¨³å¥å‹</button>
                    <button class="btn btn-primary" onclick="loadPreset('aggressive')">æ¿€è¿›å‹</button>
                </div>
            </div>

            <div class="form-section">
                <h3>ğŸ’¾ é…ç½®æ“ä½œ</h3>
                <div>
                    <button class="btn btn-success" onclick="saveConfig()">ğŸ’¾ ä¿å­˜é…ç½®åˆ°æœåŠ¡å™¨</button>
                    <button class="btn btn-primary" onclick="generateConfig()">ğŸ“„ ç”Ÿæˆé…ç½®æ–‡ä»¶</button>
                    <button class="btn btn-warning" onclick="resetForm()">ğŸ”„ é‡ç½®è¡¨å•</button>
                </div>
            </div>

            <div id="config-result" class="results-panel" style="display: none;">
                <h4>ğŸ“„ ç”Ÿæˆçš„é…ç½®</h4>
                <div class="code-block" id="config-json"></div>
                <div style="margin-top: 15px;">
                    <button class="btn btn-primary" onclick="copyConfig()">ğŸ“‹ å¤åˆ¶é…ç½®</button>
                    <button class="btn btn-success" onclick="downloadConfig()">ğŸ’¾ ä¸‹è½½é…ç½®</button>
                </div>
            </div>
        </div>

        <!-- å›æµ‹æ‰§è¡Œæ ‡ç­¾é¡µ -->
        <div id="backtest" class="tab-content">
            <div class="status-panel">
                <h3>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h3>
                <div class="status-item">
                    <span class="status-label">æœåŠ¡å™¨çŠ¶æ€</span>
                    <span class="status-value" id="server-status">æ£€æŸ¥ä¸­...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">é…ç½®æ–‡ä»¶</span>
                    <span class="status-value" id="config-status">æ£€æŸ¥ä¸­...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">æœ€æ–°å›æµ‹</span>
                    <span class="status-value" id="latest-backtest">æ£€æŸ¥ä¸­...</span>
                </div>
            </div>

            <div class="form-section">
                <h3>ğŸš€ å›æµ‹æ‰§è¡Œ</h3>
                <div class="alert alert-info">
                    <strong>ğŸ’¡ æç¤º:</strong> å›æµ‹æ‰§è¡Œéœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚å»ºè®®å…ˆä¿å­˜é…ç½®å†è¿›è¡Œå›æµ‹ã€‚
                </div>
                <div>
                    <button class="btn btn-success" onclick="runBacktest()" id="run-backtest-btn">
                        ğŸš€ å¼€å§‹å›æµ‹
                    </button>
                    <button class="btn btn-warning" onclick="refreshStatus()">
                        ğŸ”„ åˆ·æ–°çŠ¶æ€
                    </button>
                </div>
            </div>

            <div class="loading" id="backtest-loading">
                <div class="spinner"></div>
                <p>å›æµ‹æ‰§è¡Œä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…...</p>
                <p><small>è¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´</small></p>
            </div>

            <div id="backtest-result" class="results-panel" style="display: none;">
                <h4>ğŸ“Š å›æµ‹æ‰§è¡Œç»“æœ</h4>
                <div id="backtest-output" class="code-block"></div>
            </div>
        </div>

        <!-- ç»“æœåˆ†ææ ‡ç­¾é¡µ -->
        <div id="results" class="tab-content">
            <div class="form-section">
                <h3>ğŸ“ˆ å›æµ‹ç»“æœåˆ†æ</h3>
                <div>
                    <button class="btn btn-primary" onclick="loadResults()">ğŸ”„ åŠ è½½æœ€æ–°ç»“æœ</button>
                    <button class="btn btn-success" onclick="exportResults()">ğŸ“Š å¯¼å‡ºç»“æœ</button>
                </div>
            </div>

            <div id="results-content">
                <div class="alert alert-info">
                    ç‚¹å‡»"åŠ è½½æœ€æ–°ç»“æœ"æŸ¥çœ‹å›æµ‹åˆ†ææ•°æ®
                </div>
            </div>
        </div>

        <!-- é…ç½®å·¥å…·æ ‡ç­¾é¡µ -->
        <div id="config-manage" class="tab-content">
            <div class="form-section">
                <h3>ğŸ”§ é…ç½®ç®¡ç†å·¥å…·</h3>
                <div class="alert alert-info">
                    <strong>ğŸ’¡ æç¤º:</strong> ç®¡ç†æœ¬åœ°é…ç½®æ–‡ä»¶å’Œç½‘é¡µæœåŠ¡é…ç½®æ–‡ä»¶çš„åŒæ­¥ã€‚
                </div>
                <div>
                    <button class="btn btn-primary" onclick="loadConfigStatus()">ğŸ”„ åˆ·æ–°é…ç½®çŠ¶æ€</button>
                    <button class="btn btn-success" onclick="useWebConfig()">ğŸ“¥ ä½¿ç”¨ç½‘é¡µé…ç½®</button>
                    <button class="btn btn-warning" onclick="backupConfig()">ğŸ’¾ å¤‡ä»½å½“å‰é…ç½®</button>
                </div>
            </div>

            <div class="status-panel">
                <h3>ğŸ“Š é…ç½®çŠ¶æ€</h3>
                <div class="status-item">
                    <span class="status-label">æœ¬åœ°é…ç½®æ–‡ä»¶</span>
                    <span class="status-value" id="local-config-status">æ£€æŸ¥ä¸­...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">ç½‘é¡µæœåŠ¡é…ç½®</span>
                    <span class="status-value" id="web-config-status">æ£€æŸ¥ä¸­...</span>
                </div>
                <div class="status-item">
                    <span class="status-label">é…ç½®å¤‡ä»½æ•°é‡</span>
                    <span class="status-value" id="backup-count">æ£€æŸ¥ä¸­...</span>
                </div>
            </div>

            <div class="form-section">
                <h3>ğŸ“‹ é…ç½®è¯¦æƒ…</h3>
                <div id="config-details">
                    <div class="alert alert-info">
                        ç‚¹å‡»"åˆ·æ–°é…ç½®çŠ¶æ€"æŸ¥çœ‹è¯¦ç»†é…ç½®ä¿¡æ¯
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>âœï¸ é…ç½®å‚æ•°ç¼–è¾‘</h3>
                <div class="alert alert-info">
                    <strong>ğŸ’¡ æç¤º:</strong> ç¼–è¾‘é…ç½®å‚æ•°åéœ€è¦ä¿å­˜åˆ°æœåŠ¡å™¨æ‰èƒ½ç”Ÿæ•ˆã€‚
                </div>
                <div>
                    <button class="btn btn-primary" onclick="loadConfigForEdit()">ğŸ“¥ åŠ è½½é…ç½®è¿›è¡Œç¼–è¾‘</button>
                    <button class="btn btn-success" onclick="saveEditedConfig()">ğŸ’¾ ä¿å­˜ç¼–è¾‘çš„é…ç½®</button>
                    <button class="btn btn-warning" onclick="resetEditedConfig()">ğŸ”„ é‡ç½®ç¼–è¾‘</button>
                </div>
            </div>

            <div id="config-edit-panel" class="form-section" style="display: none;">
                <h3>ğŸ“ ç¼–è¾‘é…ç½®å‚æ•°</h3>
                
                <!-- å›æµ‹é…ç½® -->
                <div class="config-edit-section">
                    <h4>ğŸ“Š å›æµ‹é…ç½®</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>å¼€å§‹æ—¥æœŸ</label>
                            <input type="date" id="edit_start_date">
                        </div>
                        <div class="form-group">
                            <label>ç»“æŸæ—¥æœŸ</label>
                            <input type="date" id="edit_end_date">
                        </div>
                        <div class="form-group">
                            <label>åˆå§‹èµ„é‡‘</label>
                            <input type="number" id="edit_starting_balance" min="1000" step="1000">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>äº¤æ˜“æ‰€</label>
                            <select id="edit_exchange">
                                <option value="binance">Binance</option>
                                <option value="okx">OKX</option>
                                <option value="bybit">Bybit</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- å¤šå¤´ç­–ç•¥é…ç½® -->
                <div class="config-edit-section">
                    <h4>ğŸ“ˆ å¤šå¤´ç­–ç•¥é…ç½®</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>å…¥åœºç½‘æ ¼é—´è· (%)</label>
                            <input type="number" id="edit_entry_grid_spacing_pct" min="0.001" max="0.1" step="0.001">
                        </div>
                        <div class="form-group">
                            <label>åˆå§‹å…¥åœºæ•°é‡ (%)</label>
                            <input type="number" id="edit_entry_initial_qty_pct" min="0.001" max="0.1" step="0.001">
                        </div>
                        <div class="form-group">
                            <label>æœ€å¤§æŒä»“æ•°</label>
                            <input type="number" id="edit_n_positions" min="1" max="10" step="1">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>å¹³ä»“ç½‘æ ¼èµ·å§‹ (%)</label>
                            <input type="number" id="edit_close_grid_markup_start" min="0.001" max="0.05" step="0.001">
                        </div>
                        <div class="form-group">
                            <label>å¹³ä»“ç½‘æ ¼ç»“æŸ (%)</label>
                            <input type="number" id="edit_close_grid_markup_end" min="0.001" max="0.05" step="0.001">
                        </div>
                        <div class="form-group">
                            <label>æ€»èµ„é‡‘æš´éœ²é™åˆ¶</label>
                            <input type="number" id="edit_total_wallet_exposure_limit" min="0.1" max="2.0" step="0.1">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>EMAå‘¨æœŸ0</label>
                            <input type="number" id="edit_ema_span_0" min="10" max="1000" step="1">
                        </div>
                        <div class="form-group">
                            <label>EMAå‘¨æœŸ1</label>
                            <input type="number" id="edit_ema_span_1" min="10" max="1000" step="1">
                        </div>
                    </div>
                </div>

                <!-- ç©ºå¤´ç­–ç•¥é…ç½® -->
                <div class="config-edit-section">
                    <h4>ğŸ“‰ ç©ºå¤´ç­–ç•¥é…ç½®</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>å…¥åœºç½‘æ ¼é—´è· (%)</label>
                            <input type="number" id="edit_short_entry_grid_spacing_pct" min="0.001" max="0.1" step="0.001">
                        </div>
                        <div class="form-group">
                            <label>åˆå§‹å…¥åœºæ•°é‡ (%)</label>
                            <input type="number" id="edit_short_entry_initial_qty_pct" min="0.001" max="0.1" step="0.001">
                        </div>
                        <div class="form-group">
                            <label>æœ€å¤§æŒä»“æ•°</label>
                            <input type="number" id="edit_short_n_positions" min="1" max="10" step="1">
                        </div>
                    </div>
                </div>

                <!-- å®ç›˜é…ç½® -->
                <div class="config-edit-section">
                    <h4>ğŸš€ å®ç›˜é…ç½®</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>äº¤æ˜“å¯¹</label>
                            <select id="edit_symbol">
                                <option value="BTCUSDT">BTC/USDT</option>
                                <option value="ETHUSDT">ETH/USDT</option>
                                <option value="ADAUSDT">ADA/USDT</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>æ æ†å€æ•°</label>
                            <input type="number" id="edit_leverage" min="1" max="100" step="1">
                        </div>
                        <div class="form-group">
                            <label>ç”¨æˆ·æ ‡è¯†</label>
                            <input type="text" id="edit_user" placeholder="è¾“å…¥ç”¨æˆ·æ ‡è¯†">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>è®¢å•æœ‰æ•ˆæœŸ</label>
                            <select id="edit_time_in_force">
                                <option value="GTC">GTC (æ’¤é”€å‰æœ‰æ•ˆ)</option>
                                <option value="IOC">IOC (ç«‹å³æˆäº¤æˆ–æ’¤é”€)</option>
                                <option value="FOK">FOK (å…¨éƒ¨æˆäº¤æˆ–æ’¤é”€)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>æ‰§è¡Œå»¶è¿Ÿ (ç§’)</label>
                            <input type="number" id="edit_execution_delay_seconds" min="0" max="60" step="1">
                        </div>
                        <div class="form-group">
                            <label>æœ€å°å¸é¾„ (å¤©)</label>
                            <input type="number" id="edit_minimum_coin_age_days" min="1" max="365" step="1">
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>ğŸš€ å¿«é€Ÿæ“ä½œ</h3>
                <div class="alert alert-warning">
                    <strong>âš ï¸ é‡è¦:</strong> ä½¿ç”¨ç½‘é¡µé…ç½®ä¼šè¦†ç›–å½“å‰æœ¬åœ°é…ç½®ï¼Œè¯·ç¡®ä¿å·²å¤‡ä»½é‡è¦é…ç½®ã€‚
                </div>
                <div>
                    <button class="btn btn-success" onclick="setWebConfigActive()">
                        ğŸ¯ è®¾ç½®ç½‘é¡µé…ç½®ä¸ºæ´»åŠ¨é…ç½®
                    </button>
                    <button class="btn btn-primary" onclick="openQuickStart()">
                        ğŸš€ æ‰“å¼€å¿«é€Ÿå¯åŠ¨è„šæœ¬
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ ‡ç­¾é¡µåˆ‡æ¢
        function switchTab(tabName) {
            // éšè—æ‰€æœ‰æ ‡ç­¾é¡µå†…å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // æ˜¾ç¤ºé€‰ä¸­çš„æ ‡ç­¾é¡µ
            document.getElementById(tabName).classList.add('active');
            
            // æ¿€æ´»å¯¹åº”çš„æ ‡ç­¾
            event.target.classList.add('active');
            
            // å¦‚æœåˆ‡æ¢åˆ°ç»“æœé¡µé¢ï¼Œè‡ªåŠ¨åŠ è½½ç»“æœ
            if (tabName === 'results') {
                loadResults();
            }
            
            // å¦‚æœåˆ‡æ¢åˆ°é…ç½®ç®¡ç†é¡µé¢ï¼Œè‡ªåŠ¨åŠ è½½é…ç½®çŠ¶æ€
            if (tabName === 'config-manage') {
                loadConfigStatus();
            }
        }

        // åŠ è½½é¢„è®¾é…ç½®
        function loadPreset(type) {
            const presets = {
                conservative: {
                    entry_grid_spacing_pct: 0.005,
                    entry_initial_qty_pct: 0.005,
                    n_positions: 2,
                    close_grid_markup_start: 0.001,
                    close_grid_markup_end: 0.0005,
                    total_wallet_exposure_limit: 0.3
                },
                moderate: {
                    entry_grid_spacing_pct: 0.01,
                    entry_initial_qty_pct: 0.01,
                    n_positions: 3,
                    close_grid_markup_start: 0.002,
                    close_grid_markup_end: 0.001,
                    total_wallet_exposure_limit: 0.5
                },
                aggressive: {
                    entry_grid_spacing_pct: 0.02,
                    entry_initial_qty_pct: 0.02,
                    n_positions: 5,
                    close_grid_markup_start: 0.005,
                    close_grid_markup_end: 0.002,
                    total_wallet_exposure_limit: 1.0
                }
            };

            const preset = presets[type];
            for (const [key, value] of Object.entries(preset)) {
                const element = document.getElementById(key);
                if (element) {
                    element.value = value;
                }
            }
            
            showAlert('success', `å·²åŠ è½½${type === 'conservative' ? 'ä¿å®ˆå‹' : type === 'moderate' ? 'ç¨³å¥å‹' : 'æ¿€è¿›å‹'}é…ç½®`);
        }

        // ç”Ÿæˆé…ç½®
        function generateConfig() {
            const config = {
                backtest: {
                    base_dir: "backtests",
                    combine_ohlcvs: true,
                    compress_cache: true,
                    start_date: document.getElementById('start_date').value,
                    end_date: document.getElementById('end_date').value,
                    starting_balance: parseInt(document.getElementById('starting_balance').value),
                    exchanges: [document.getElementById('exchange').value],
                    gap_tolerance_ohlcvs_minutes: 120,
                    use_btc_collateral: true
                },
                bot: {
                    long: {
                        close_grid_markup_end: parseFloat(document.getElementById('close_grid_markup_end').value),
                        close_grid_markup_start: parseFloat(document.getElementById('close_grid_markup_start').value),
                        close_grid_qty_pct: 0.5,
                        close_trailing_grid_ratio: 0.0,
                        close_trailing_qty_pct: 0.0,
                        close_trailing_retracement_pct: 0.0,
                        close_trailing_threshold_pct: 0.0,
                        ema_span_0: 100,
                        ema_span_1: 200,
                        enforce_exposure_limit: true,
                        entry_grid_double_down_factor: 1.0,
                        entry_grid_spacing_pct: parseFloat(document.getElementById('entry_grid_spacing_pct').value),
                        entry_grid_spacing_weight: 1.0,
                        entry_initial_ema_dist: 0.0,
                        entry_initial_qty_pct: parseFloat(document.getElementById('entry_initial_qty_pct').value),
                        entry_trailing_double_down_factor: 1.0,
                        entry_trailing_grid_ratio: 0.0,
                        entry_trailing_retracement_pct: 0.0,
                        entry_trailing_threshold_pct: 0.0,
                        filter_noisiness_rolling_window: 20,
                        filter_volume_drop_pct: 0.0,
                        filter_volume_rolling_window: 100,
                        n_positions: parseInt(document.getElementById('n_positions').value),
                        total_wallet_exposure_limit: parseFloat(document.getElementById('total_wallet_exposure_limit').value),
                        unstuck_close_pct: 0.01,
                        unstuck_ema_dist: 0.001,
                        unstuck_loss_allowance_pct: 0.001,
                        unstuck_threshold: 0.5
                    },
                    short: {
                        close_grid_markup_end: parseFloat(document.getElementById('close_grid_markup_end').value),
                        close_grid_markup_start: parseFloat(document.getElementById('close_grid_markup_start').value),
                        close_grid_qty_pct: 0.5,
                        close_trailing_grid_ratio: 0.0,
                        close_trailing_qty_pct: 0.0,
                        close_trailing_retracement_pct: 0.0,
                        close_trailing_threshold_pct: 0.0,
                        ema_span_0: 100,
                        ema_span_1: 200,
                        enforce_exposure_limit: true,
                        entry_grid_double_down_factor: 1.0,
                        entry_grid_spacing_pct: parseFloat(document.getElementById('short_entry_grid_spacing_pct').value),
                        entry_grid_spacing_weight: 1.0,
                        entry_initial_ema_dist: 0.0,
                        entry_initial_qty_pct: parseFloat(document.getElementById('short_entry_initial_qty_pct').value),
                        entry_trailing_double_down_factor: 1.0,
                        entry_trailing_grid_ratio: 0.0,
                        entry_trailing_retracement_pct: 0.0,
                        entry_trailing_threshold_pct: 0.0,
                        filter_noisiness_rolling_window: 20,
                        filter_volume_drop_pct: 0.0,
                        filter_volume_rolling_window: 100,
                        n_positions: parseInt(document.getElementById('short_n_positions').value),
                        total_wallet_exposure_limit: parseFloat(document.getElementById('total_wallet_exposure_limit').value),
                        unstuck_close_pct: 0.01,
                        unstuck_ema_dist: 0.001,
                        unstuck_loss_allowance_pct: 0.001,
                        unstuck_threshold: 0.5
                    }
                },
                live: {
                    approved_coins: [document.getElementById('symbol').value],
                    auto_gs: false,
                    empty_means_all_approved: false,
                    execution_delay_seconds: 0,
                    filter_by_min_effective_cost: false,
                    forced_mode_long: "n",
                    forced_mode_short: "n",
                    ignored_coins: { long: [], short: [] },
                    leverage: 1.0,
                    market_orders_allowed: false,
                    max_n_cancellations_per_batch: 100,
                    max_n_creations_per_batch: 100,
                    max_n_restarts_per_day: 10,
                    mimic_backtest_1m_delay: false,
                    minimum_coin_age_days: 30,
                    ohlcvs_1m_rolling_window_days: 7,
                    ohlcvs_1m_update_after_minutes: 1,
                    pnls_max_lookback_days: 30,
                    price_distance_threshold: 0.002,
                    time_in_force: "GTC",
                    user: "web_user"
                }
            };

            document.getElementById('config-json').textContent = JSON.stringify(config, null, 2);
            document.getElementById('config-result').style.display = 'block';
            
            showAlert('success', 'é…ç½®ç”ŸæˆæˆåŠŸï¼');
        }

        // ä¿å­˜é…ç½®åˆ°æœåŠ¡å™¨
        async function saveConfig() {
            generateConfig(); // å…ˆç”Ÿæˆé…ç½®
            
            const configText = document.getElementById('config-json').textContent;
            const config = JSON.parse(configText);
            
            try {
                const response = await fetch('/api/save-config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(config)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert('success', result.message);
                    refreshStatus(); // åˆ·æ–°çŠ¶æ€
                } else {
                    showAlert('danger', result.message);
                }
            } catch (error) {
                showAlert('danger', 'ä¿å­˜é…ç½®å¤±è´¥: ' + error.message);
            }
        }

        // è¿è¡Œå›æµ‹
        async function runBacktest() {
            const btn = document.getElementById('run-backtest-btn');
            const loading = document.getElementById('backtest-loading');
            const result = document.getElementById('backtest-result');
            
            btn.disabled = true;
            loading.style.display = 'block';
            result.style.display = 'none';
            
            try {
                const response = await fetch('/api/run-backtest', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('success', data.message);
                    
                    // å¼€å§‹è½®è¯¢ç»“æœ
                    pollBacktestResults();
                } else {
                    showAlert('danger', data.message);
                    btn.disabled = false;
                    loading.style.display = 'none';
                }
            } catch (error) {
                showAlert('danger', 'å¯åŠ¨å›æµ‹å¤±è´¥: ' + error.message);
                btn.disabled = false;
                loading.style.display = 'none';
            }
        }

        // è½®è¯¢å›æµ‹ç»“æœ
        async function pollBacktestResults() {
            const maxAttempts = 60; // æœ€å¤šè½®è¯¢60æ¬¡
            let attempts = 0;
            
            const poll = async () => {
                attempts++;
                
                try {
                    const response = await fetch('/api/backtest/results');
                    const data = await response.json();
                    
                    if (data.execution && data.execution.timestamp > 0) {
                        // å›æµ‹å®Œæˆ
                        document.getElementById('backtest-loading').style.display = 'none';
                        document.getElementById('run-backtest-btn').disabled = false;
                        
                        const output = document.getElementById('backtest-output');
                        if (data.execution.success) {
                            output.textContent = data.execution.stdout || 'å›æµ‹æ‰§è¡ŒæˆåŠŸ';
                            showAlert('success', 'å›æµ‹æ‰§è¡Œå®Œæˆï¼');
                        } else {
                            output.textContent = data.execution.stderr || data.execution.error || 'å›æµ‹æ‰§è¡Œå¤±è´¥';
                            showAlert('danger', 'å›æµ‹æ‰§è¡Œå¤±è´¥');
                        }
                        
                        document.getElementById('backtest-result').style.display = 'block';
                        refreshStatus();
                        return;
                    }
                    
                    if (attempts < maxAttempts) {
                        setTimeout(poll, 5000); // 5ç§’åå†æ¬¡æ£€æŸ¥
                    } else {
                        document.getElementById('backtest-loading').style.display = 'none';
                        document.getElementById('run-backtest-btn').disabled = false;
                        showAlert('warning', 'å›æµ‹è¶…æ—¶ï¼Œè¯·æ‰‹åŠ¨æ£€æŸ¥ç»“æœ');
                    }
                } catch (error) {
                    console.error('è½®è¯¢å›æµ‹ç»“æœå¤±è´¥:', error);
                    if (attempts < maxAttempts) {
                        setTimeout(poll, 5000);
                    }
                }
            };
            
            poll();
        }

        // åŠ è½½å›æµ‹ç»“æœ
        async function loadResults() {
            try {
                const response = await fetch('/api/backtest/results');
                const data = await response.json();
                
                const resultsContent = document.getElementById('results-content');
                
                if (data.analysis) {
                    const analysis = data.analysis;
                    
                    // è®¡ç®—å…³é”®æŒ‡æ ‡
                    const initialBalance = 10000;
                    const finalBalance = initialBalance * (1 + analysis.gain);
                    const totalProfit = finalBalance - initialBalance;
                    const totalReturn = analysis.gain * 100;
                    
                    resultsContent.innerHTML = `
                        <div class="results-section">
                            <h4>ğŸ’° æ ¸å¿ƒç›ˆåˆ©æŒ‡æ ‡</h4>
                            <div class="metric-grid">
                                <div class="metric-card">
                                    <div class="metric-value">$${initialBalance.toLocaleString()}</div>
                                    <div class="metric-label">åˆå§‹èµ„é‡‘</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value">$${finalBalance.toLocaleString()}</div>
                                    <div class="metric-label">æœ€ç»ˆèµ„é‡‘</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value">$${totalProfit.toLocaleString()}</div>
                                    <div class="metric-label">æ€»æ”¶ç›Š</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value">${totalReturn.toFixed(2)}%</div>
                                    <div class="metric-label">æ€»æ”¶ç›Šç‡</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="results-section">
                            <h4>ğŸ“Š é£é™©æŒ‡æ ‡</h4>
                            <div class="metric-grid">
                                <div class="metric-card">
                                    <div class="metric-value">${(analysis.drawdown_worst * 100).toFixed(2)}%</div>
                                    <div class="metric-label">æœ€å¤§å›æ’¤</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value">${analysis.sharpe_ratio.toFixed(4)}</div>
                                    <div class="metric-label">å¤æ™®æ¯”ç‡</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value">${analysis.sortino_ratio.toFixed(4)}</div>
                                    <div class="metric-label">ç´¢æè¯ºæ¯”ç‡</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value">${analysis.positions_held_per_day.toFixed(1)}</div>
                                    <div class="metric-label">æ—¥å‡æŒä»“æ•°</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="results-section">
                            <h4>ğŸ“ˆ äº¤æ˜“ç»Ÿè®¡</h4>
                            <div class="metric-grid">
                                <div class="metric-card">
                                    <div class="metric-value">${analysis.position_held_hours_mean.toFixed(2)}h</div>
                                    <div class="metric-label">å¹³å‡æŒä»“æ—¶é—´</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value">${analysis.position_held_hours_max.toFixed(2)}h</div>
                                    <div class="metric-label">æœ€é•¿æŒä»“æ—¶é—´</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-success">
                            <strong>âœ… å›æµ‹åˆ†æå®Œæˆï¼</strong> è¯¦ç»†æ•°æ®å·²ä¿å­˜åˆ°æœåŠ¡å™¨ã€‚
                        </div>
                    `;
                } else {
                    resultsContent.innerHTML = `
                        <div class="alert alert-warning">
                            <strong>âš ï¸ æš‚æ— å›æµ‹ç»“æœ</strong> è¯·å…ˆæ‰§è¡Œå›æµ‹ã€‚
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('results-content').innerHTML = `
                    <div class="alert alert-danger">
                        <strong>âŒ åŠ è½½ç»“æœå¤±è´¥:</strong> ${error.message}
                    </div>
                `;
            }
        }

        // åˆ·æ–°çŠ¶æ€
        async function refreshStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                
                document.getElementById('server-status').textContent = data.status;
                document.getElementById('server-status').className = 'status-value success';
                
                document.getElementById('config-status').textContent = data.config_exists ? 'å·²å­˜åœ¨' : 'ä¸å­˜åœ¨';
                document.getElementById('config-status').className = data.config_exists ? 'status-value success' : 'status-value error';
                
                document.getElementById('latest-backtest').textContent = data.backtest_dir ? 'æœ‰æ•°æ®' : 'æ— æ•°æ®';
                document.getElementById('latest-backtest').className = data.backtest_dir ? 'status-value success' : 'status-value warning';
            } catch (error) {
                document.getElementById('server-status').textContent = 'è¿æ¥å¤±è´¥';
                document.getElementById('server-status').className = 'status-value error';
            }
        }

        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showAlert(type, message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `<strong>${type === 'success' ? 'âœ…' : type === 'danger' ? 'âŒ' : 'âš ï¸'}</strong> ${message}`;
            
            // æ’å…¥åˆ°å½“å‰æ ‡ç­¾é¡µçš„é¡¶éƒ¨
            const activeTab = document.querySelector('.tab-content.active');
            activeTab.insertBefore(alertDiv, activeTab.firstChild);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }

        // å¤åˆ¶é…ç½®
        function copyConfig() {
            const configText = document.getElementById('config-json').textContent;
            navigator.clipboard.writeText(configText).then(() => {
                showAlert('success', 'é…ç½®å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }).catch(() => {
                showAlert('danger', 'å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            });
        }

        // ä¸‹è½½é…ç½®
        function downloadConfig() {
            const configText = document.getElementById('config-json').textContent;
            const blob = new Blob([configText], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'my_config.json';
            a.click();
            URL.revokeObjectURL(url);
            showAlert('success', 'é…ç½®æ–‡ä»¶å·²ä¸‹è½½');
        }

        // é‡ç½®è¡¨å•
        function resetForm() {
            document.querySelectorAll('input, select').forEach(element => {
                if (element.type === 'date') {
                    element.value = element.id === 'start_date' ? '2024-01-01' : '2024-01-31';
                } else if (element.type === 'number') {
                    element.value = element.defaultValue || '0';
                } else if (element.tagName === 'SELECT') {
                    element.selectedIndex = 0;
                }
            });
            document.getElementById('config-result').style.display = 'none';
            showAlert('info', 'è¡¨å•å·²é‡ç½®');
        }

        // å¯¼å‡ºç»“æœ
        function exportResults() {
            showAlert('info', 'å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­...');
        }

        // åŠ è½½é…ç½®çŠ¶æ€
        async function loadConfigStatus() {
            try {
                const response = await fetch('/api/config/status');
                const data = await response.json();
                
                // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                document.getElementById('local-config-status').textContent = 
                    data.local_config.exists ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨';
                document.getElementById('local-config-status').className = 
                    data.local_config.exists ? 'status-value success' : 'status-value error';
                
                document.getElementById('web-config-status').textContent = 
                    data.web_config.exists ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨';
                document.getElementById('web-config-status').className = 
                    data.web_config.exists ? 'status-value success' : 'status-value error';
                
                document.getElementById('backup-count').textContent = 
                    `${data.backups.length} ä¸ªå¤‡ä»½`;
                document.getElementById('backup-count').className = 
                    data.backups.length > 0 ? 'status-value success' : 'status-value warning';
                
                // æ˜¾ç¤ºé…ç½®è¯¦æƒ…
                const detailsDiv = document.getElementById('config-details');
                let detailsHtml = '<div class="metric-grid">';
                
                if (data.local_config.exists) {
                    detailsHtml += `
                        <div class="metric-card">
                            <div class="metric-value">æœ¬åœ°é…ç½®</div>
                            <div class="metric-label">å¤§å°: ${(data.local_config.size / 1024).toFixed(1)} KB</div>
                            <div class="metric-label">ä¿®æ”¹: ${new Date(data.local_config.modified * 1000).toLocaleString()}</div>
                        </div>
                    `;
                }
                
                if (data.web_config.exists) {
                    detailsHtml += `
                        <div class="metric-card">
                            <div class="metric-value">ç½‘é¡µé…ç½®</div>
                            <div class="metric-label">å¤§å°: ${(data.web_config.size / 1024).toFixed(1)} KB</div>
                            <div class="metric-label">ä¿®æ”¹: ${new Date(data.web_config.modified * 1000).toLocaleString()}</div>
                        </div>
                    `;
                }
                
                if (data.backups.length > 0) {
                    detailsHtml += `
                        <div class="metric-card">
                            <div class="metric-value">${data.backups.length}</div>
                            <div class="metric-label">é…ç½®å¤‡ä»½</div>
                            <div class="metric-label">æœ€æ–°: ${new Date(data.backups[0].modified * 1000).toLocaleString()}</div>
                        </div>
                    `;
                }
                
                detailsHtml += '</div>';
                
                // æ˜¾ç¤ºé…ç½®å‚æ•°è¯¦æƒ…
                if (data.config_details) {
                    detailsHtml += '<div class="results-section">';
                    detailsHtml += '<h4>ğŸ“‹ é…ç½®å‚æ•°è¯¦æƒ…</h4>';
                    
                    // æ˜¾ç¤ºæœ¬åœ°é…ç½®å‚æ•°
                    if (data.config_details.local_config) {
                        detailsHtml += '<h5>ğŸ’» æœ¬åœ°é…ç½®å‚æ•°</h5>';
                        detailsHtml += formatConfigDetails(data.config_details.local_config);
                    }
                    
                    // æ˜¾ç¤ºç½‘é¡µé…ç½®å‚æ•°
                    if (data.config_details.web_config) {
                        detailsHtml += '<h5>ğŸŒ ç½‘é¡µé…ç½®å‚æ•°</h5>';
                        detailsHtml += formatConfigDetails(data.config_details.web_config);
                    }
                    
                    detailsHtml += '</div>';
                }
                
                if (data.backups.length > 0) {
                    detailsHtml += '<div class="results-section">';
                    detailsHtml += '<h4>ğŸ“ å¤‡ä»½æ–‡ä»¶åˆ—è¡¨</h4><ul>';
                    data.backups.slice(0, 5).forEach(backup => {
                        detailsHtml += `<li>${backup.name} (${new Date(backup.modified * 1000).toLocaleString()})</li>`;
                    });
                    if (data.backups.length > 5) {
                        detailsHtml += `<li>... è¿˜æœ‰ ${data.backups.length - 5} ä¸ªå¤‡ä»½</li>`;
                    }
                    detailsHtml += '</ul></div>';
                }
                
                detailsDiv.innerHTML = detailsHtml;
                
            } catch (error) {
                showAlert('danger', 'åŠ è½½é…ç½®çŠ¶æ€å¤±è´¥: ' + error.message);
            }
        }

        // ä½¿ç”¨ç½‘é¡µé…ç½®
        async function useWebConfig() {
            if (!confirm('ç¡®å®šè¦ä½¿ç”¨ç½‘é¡µæœåŠ¡é…ç½®å—ï¼Ÿè¿™å°†è¦†ç›–å½“å‰æœ¬åœ°é…ç½®ã€‚')) {
                return;
            }
            
            try {
                const response = await fetch('/api/config/use-web', {
                    method: 'GET'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('success', data.message);
                    loadConfigStatus(); // åˆ·æ–°çŠ¶æ€
                } else {
                    showAlert('danger', data.message);
                }
            } catch (error) {
                showAlert('danger', 'ä½¿ç”¨ç½‘é¡µé…ç½®å¤±è´¥: ' + error.message);
            }
        }

        // å¤‡ä»½é…ç½®
        async function backupConfig() {
            try {
                const response = await fetch('/api/config/backup', {
                    method: 'GET'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('success', data.message);
                    loadConfigStatus(); // åˆ·æ–°çŠ¶æ€
                } else {
                    showAlert('danger', data.message);
                }
            } catch (error) {
                showAlert('danger', 'å¤‡ä»½é…ç½®å¤±è´¥: ' + error.message);
            }
        }

        // è®¾ç½®ç½‘é¡µé…ç½®ä¸ºæ´»åŠ¨é…ç½®
        async function setWebConfigActive() {
            if (!confirm('ç¡®å®šè¦è®¾ç½®ç½‘é¡µé…ç½®ä¸ºæ´»åŠ¨é…ç½®å—ï¼Ÿè¿™å°†è¦†ç›–å½“å‰æœ¬åœ°é…ç½®ã€‚')) {
                return;
            }
            
            try {
                const response = await fetch('/api/config/set-active', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ source: 'web' })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('success', data.message);
                    loadConfigStatus(); // åˆ·æ–°çŠ¶æ€
                } else {
                    showAlert('danger', data.message);
                }
            } catch (error) {
                showAlert('danger', 'è®¾ç½®æ´»åŠ¨é…ç½®å¤±è´¥: ' + error.message);
            }
        }

        // æ ¼å¼åŒ–é…ç½®è¯¦æƒ…
        function formatConfigDetails(config) {
            let html = '<div class="config-details-grid">';
            
            // å›æµ‹é…ç½®
            if (config.backtest && Object.keys(config.backtest).length > 0) {
                html += '<div class="config-section">';
                html += '<h6>ğŸ“Š å›æµ‹é…ç½®</h6>';
                html += '<div class="config-params">';
                for (const [key, value] of Object.entries(config.backtest)) {
                    html += `<div class="config-param"><span class="param-name">${key}:</span> <span class="param-value">${Array.isArray(value) ? value.join(', ') : value}</span></div>`;
                }
                html += '</div></div>';
            }
            
            // å¤šå¤´ç­–ç•¥é…ç½®
            if (config.bot && config.bot.long && Object.keys(config.bot.long).length > 0) {
                html += '<div class="config-section">';
                html += '<h6>ğŸ“ˆ å¤šå¤´ç­–ç•¥é…ç½®</h6>';
                html += '<div class="config-params">';
                for (const [key, value] of Object.entries(config.bot.long)) {
                    html += `<div class="config-param"><span class="param-name">${key}:</span> <span class="param-value">${value}</span></div>`;
                }
                html += '</div></div>';
            }
            
            // ç©ºå¤´ç­–ç•¥é…ç½®
            if (config.bot && config.bot.short && Object.keys(config.bot.short).length > 0) {
                html += '<div class="config-section">';
                html += '<h6>ğŸ“‰ ç©ºå¤´ç­–ç•¥é…ç½®</h6>';
                html += '<div class="config-params">';
                for (const [key, value] of Object.entries(config.bot.short)) {
                    html += `<div class="config-param"><span class="param-name">${key}:</span> <span class="param-value">${value}</span></div>`;
                }
                html += '</div></div>';
            }
            
            // å®ç›˜é…ç½®
            if (config.live && Object.keys(config.live).length > 0) {
                html += '<div class="config-section">';
                html += '<h6>ğŸš€ å®ç›˜é…ç½®</h6>';
                html += '<div class="config-params">';
                for (const [key, value] of Object.entries(config.live)) {
                    html += `<div class="config-param"><span class="param-name">${key}:</span> <span class="param-value">${Array.isArray(value) ? value.join(', ') : value}</span></div>`;
                }
                html += '</div></div>';
            }
            
            html += '</div>';
            return html;
        }

        // åŠ è½½é…ç½®è¿›è¡Œç¼–è¾‘
        async function loadConfigForEdit() {
            try {
                const response = await fetch('/api/config/status');
                const data = await response.json();
                
                let configToLoad = null;
                
                // ä¼˜å…ˆä½¿ç”¨ç½‘é¡µé…ç½®ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨æœ¬åœ°é…ç½®
                if (data.config_details && data.config_details.web_config) {
                    configToLoad = data.config_details.web_config;
                    showAlert('info', 'å·²åŠ è½½ç½‘é¡µé…ç½®è¿›è¡Œç¼–è¾‘');
                } else if (data.config_details && data.config_details.local_config) {
                    configToLoad = data.config_details.local_config;
                    showAlert('info', 'å·²åŠ è½½æœ¬åœ°é…ç½®è¿›è¡Œç¼–è¾‘');
                } else {
                    showAlert('warning', 'æ²¡æœ‰æ‰¾åˆ°å¯ç¼–è¾‘çš„é…ç½®');
                    return;
                }
                
                // å¡«å……è¡¨å•
                fillEditForm(configToLoad);
                
                // æ˜¾ç¤ºç¼–è¾‘é¢æ¿
                document.getElementById('config-edit-panel').style.display = 'block';
                
            } catch (error) {
                showAlert('danger', 'åŠ è½½é…ç½®å¤±è´¥: ' + error.message);
            }
        }

        // å¡«å……ç¼–è¾‘è¡¨å•
        function fillEditForm(config) {
            // å›æµ‹é…ç½®
            if (config.backtest) {
                document.getElementById('edit_start_date').value = config.backtest.start_date || '';
                document.getElementById('edit_end_date').value = config.backtest.end_date || '';
                document.getElementById('edit_starting_balance').value = config.backtest.starting_balance || '';
                document.getElementById('edit_exchange').value = config.backtest.exchanges?.[0] || 'binance';
            }
            
            // å¤šå¤´ç­–ç•¥é…ç½®
            if (config.bot && config.bot.long) {
                const long = config.bot.long;
                document.getElementById('edit_entry_grid_spacing_pct').value = long.entry_grid_spacing_pct || '';
                document.getElementById('edit_entry_initial_qty_pct').value = long.entry_initial_qty_pct || '';
                document.getElementById('edit_n_positions').value = long.n_positions || '';
                document.getElementById('edit_close_grid_markup_start').value = long.close_grid_markup_start || '';
                document.getElementById('edit_close_grid_markup_end').value = long.close_grid_markup_end || '';
                document.getElementById('edit_total_wallet_exposure_limit').value = long.total_wallet_exposure_limit || '';
                document.getElementById('edit_ema_span_0').value = long.ema_span_0 || '';
                document.getElementById('edit_ema_span_1').value = long.ema_span_1 || '';
            }
            
            // ç©ºå¤´ç­–ç•¥é…ç½®
            if (config.bot && config.bot.short) {
                const short = config.bot.short;
                document.getElementById('edit_short_entry_grid_spacing_pct').value = short.entry_grid_spacing_pct || '';
                document.getElementById('edit_short_entry_initial_qty_pct').value = short.entry_initial_qty_pct || '';
                document.getElementById('edit_short_n_positions').value = short.n_positions || '';
            }
            
            // å®ç›˜é…ç½®
            if (config.live) {
                const live = config.live;
                document.getElementById('edit_symbol').value = live.approved_coins?.[0] || 'BTCUSDT';
                document.getElementById('edit_leverage').value = live.leverage || '';
                document.getElementById('edit_user').value = live.user || '';
                document.getElementById('edit_time_in_force').value = live.time_in_force || 'GTC';
                document.getElementById('edit_execution_delay_seconds').value = live.execution_delay_seconds || '';
                document.getElementById('edit_minimum_coin_age_days').value = live.minimum_coin_age_days || '';
            }
        }

        // ä¿å­˜ç¼–è¾‘çš„é…ç½®
        async function saveEditedConfig() {
            try {
                // æ”¶é›†è¡¨å•æ•°æ®
                const config = {
                    backtest: {
                        base_dir: "backtests",
                        combine_ohlcvs: true,
                        compress_cache: true,
                        start_date: document.getElementById('edit_start_date').value,
                        end_date: document.getElementById('edit_end_date').value,
                        starting_balance: parseInt(document.getElementById('edit_starting_balance').value),
                        exchanges: [document.getElementById('edit_exchange').value],
                        gap_tolerance_ohlcvs_minutes: 120,
                        use_btc_collateral: true
                    },
                    bot: {
                        long: {
                            close_grid_markup_end: parseFloat(document.getElementById('edit_close_grid_markup_end').value),
                            close_grid_markup_start: parseFloat(document.getElementById('edit_close_grid_markup_start').value),
                            close_grid_qty_pct: 0.5,
                            close_trailing_grid_ratio: 0.0,
                            close_trailing_qty_pct: 0.0,
                            close_trailing_retracement_pct: 0.0,
                            close_trailing_threshold_pct: 0.0,
                            ema_span_0: parseInt(document.getElementById('edit_ema_span_0').value),
                            ema_span_1: parseInt(document.getElementById('edit_ema_span_1').value),
                            enforce_exposure_limit: true,
                            entry_grid_double_down_factor: 1.0,
                            entry_grid_spacing_pct: parseFloat(document.getElementById('edit_entry_grid_spacing_pct').value),
                            entry_grid_spacing_weight: 1.0,
                            entry_initial_ema_dist: 0.0,
                            entry_initial_qty_pct: parseFloat(document.getElementById('edit_entry_initial_qty_pct').value),
                            entry_trailing_double_down_factor: 1.0,
                            entry_trailing_grid_ratio: 0.0,
                            entry_trailing_retracement_pct: 0.0,
                            entry_trailing_threshold_pct: 0.0,
                            filter_noisiness_rolling_window: 20,
                            filter_volume_drop_pct: 0.0,
                            filter_volume_rolling_window: 100,
                            n_positions: parseInt(document.getElementById('edit_n_positions').value),
                            total_wallet_exposure_limit: parseFloat(document.getElementById('edit_total_wallet_exposure_limit').value),
                            unstuck_close_pct: 0.01,
                            unstuck_ema_dist: 0.001,
                            unstuck_loss_allowance_pct: 0.001,
                            unstuck_threshold: 0.5
                        },
                        short: {
                            close_grid_markup_end: parseFloat(document.getElementById('edit_close_grid_markup_end').value),
                            close_grid_markup_start: parseFloat(document.getElementById('edit_close_grid_markup_start').value),
                            close_grid_qty_pct: 0.5,
                            close_trailing_grid_ratio: 0.0,
                            close_trailing_qty_pct: 0.0,
                            close_trailing_retracement_pct: 0.0,
                            close_trailing_threshold_pct: 0.0,
                            ema_span_0: parseInt(document.getElementById('edit_ema_span_0').value),
                            ema_span_1: parseInt(document.getElementById('edit_ema_span_1').value),
                            enforce_exposure_limit: true,
                            entry_grid_double_down_factor: 1.0,
                            entry_grid_spacing_pct: parseFloat(document.getElementById('edit_short_entry_grid_spacing_pct').value),
                            entry_grid_spacing_weight: 1.0,
                            entry_initial_ema_dist: 0.0,
                            entry_initial_qty_pct: parseFloat(document.getElementById('edit_short_entry_initial_qty_pct').value),
                            entry_trailing_double_down_factor: 1.0,
                            entry_trailing_grid_ratio: 0.0,
                            entry_trailing_retracement_pct: 0.0,
                            entry_trailing_threshold_pct: 0.0,
                            filter_noisiness_rolling_window: 20,
                            filter_volume_drop_pct: 0.0,
                            filter_volume_rolling_window: 100,
                            n_positions: parseInt(document.getElementById('edit_short_n_positions').value),
                            total_wallet_exposure_limit: parseFloat(document.getElementById('edit_total_wallet_exposure_limit').value),
                            unstuck_close_pct: 0.01,
                            unstuck_ema_dist: 0.001,
                            unstuck_loss_allowance_pct: 0.001,
                            unstuck_threshold: 0.5
                        }
                    },
                    live: {
                        approved_coins: [document.getElementById('edit_symbol').value],
                        auto_gs: false,
                        empty_means_all_approved: false,
                        execution_delay_seconds: parseInt(document.getElementById('edit_execution_delay_seconds').value),
                        filter_by_min_effective_cost: false,
                        forced_mode_long: "n",
                        forced_mode_short: "n",
                        ignored_coins: { long: [], short: [] },
                        leverage: parseFloat(document.getElementById('edit_leverage').value),
                        market_orders_allowed: false,
                        max_n_cancellations_per_batch: 100,
                        max_n_creations_per_batch: 100,
                        max_n_restarts_per_day: 10,
                        mimic_backtest_1m_delay: false,
                        minimum_coin_age_days: parseInt(document.getElementById('edit_minimum_coin_age_days').value),
                        ohlcvs_1m_rolling_window_days: 7,
                        ohlcvs_1m_update_after_minutes: 1,
                        pnls_max_lookback_days: 30,
                        price_distance_threshold: 0.002,
                        time_in_force: document.getElementById('edit_time_in_force').value,
                        user: document.getElementById('edit_user').value
                    }
                };
                
                // ä¿å­˜åˆ°æœåŠ¡å™¨
                const response = await fetch('/api/save-config', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(config)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert('success', 'é…ç½®å·²ä¿å­˜åˆ°æœåŠ¡å™¨ï¼');
                    loadConfigStatus(); // åˆ·æ–°é…ç½®çŠ¶æ€
                } else {
                    showAlert('danger', result.message);
                }
                
            } catch (error) {
                showAlert('danger', 'ä¿å­˜é…ç½®å¤±è´¥: ' + error.message);
            }
        }

        // é‡ç½®ç¼–è¾‘
        function resetEditedConfig() {
            // æ¸…ç©ºæ‰€æœ‰ç¼–è¾‘è¡¨å•
            const editInputs = document.querySelectorAll('#config-edit-panel input, #config-edit-panel select');
            editInputs.forEach(input => {
                if (input.type === 'date') {
                    input.value = '';
                } else if (input.type === 'number') {
                    input.value = '';
                } else if (input.type === 'text') {
                    input.value = '';
                } else if (input.tagName === 'SELECT') {
                    input.selectedIndex = 0;
                }
            });
            
            showAlert('info', 'ç¼–è¾‘è¡¨å•å·²é‡ç½®');
        }

        // æ‰“å¼€å¿«é€Ÿå¯åŠ¨è„šæœ¬
        function openQuickStart() {
            showAlert('info', 'è¯·åœ¨æ–°ç»ˆç«¯ä¸­è¿è¡Œ: ./quick_start.sh config-manage');
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            refreshStatus();
            
            // æ¯30ç§’è‡ªåŠ¨åˆ·æ–°çŠ¶æ€
            setInterval(refreshStatus, 30000);
        });
    </script>
</body>
</html>